# transcoder

üöß **–ü—Ä–æ–µ–∫—Ç –≤ —Å—Ç–∞–¥–∏–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏**

–î–∞–Ω–Ω—ã–π –ø—Ä–æ–µ–∫—Ç —è–≤–ª—è–µ—Ç—Å—è —á–∞—Å—Ç—å—é –¥—Ä—É–≥–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ –∏ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏, –æ–¥–Ω–∞–∫–æ –µ–≥–æ –º–æ–∂–Ω–æ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã TranscodeService –∏–ª–∏ ReturnConpiteService.

## –û–ø–∏—Å–∞–Ω–∏–µ:

–°–µ—Ä–≤–µ—Ä –æ–∂–∏–¥–∞–µ—Ç –º–∞—Å—Å–∏–≤ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–≤–æ–µ–º —ç–Ω–¥–ø–æ–∏–Ω—Ç–µ, –≤–∫–ª—é—á–∞—é—â–∏–π –≤ —Å–µ–±—è –∏–º—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Å —Ñ–∏–ª—å–º–æ–º –∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é, –∫—É–¥–∞ –±—É–¥–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω –Ω–∞—Ä–µ–∑–∞–Ω–Ω—ã–π —Ñ–∞–π–ª –≤ —Ñ–æ—Ä–º–∞—Ç–µ HLS. –¢—Ä–∞–Ω—Å–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º ffmpeg. –≠–Ω–¥–ø–æ–∏–Ω—Ç –æ–ø–∏—Å–∞–Ω —Å –ø–æ–º–æ—â—å—é Swagger –∏ –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –ø—É—Ç–∏ `/api`.

## –°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π:

PHP 8.2, Symfony 7.*, ffmpeg, Api Platform, Redis

## –†–µ–∑—É–ª—å—Ç–∞—Ç —Ç—Ä–∞–Ω—Å–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è:

```
<–î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å –∏–º–µ–Ω–µ–º —Ñ–∏–ª—å–º–∞>
    |
    |->1080p
    |    |
    |    |->1080p_000.ts
    |    |
    |    |->1080p_001.ts
    |    ...
    |    |->1080p.m3u8
    |
    |->720p
    |    |
    |    |->720p_000.ts
    |    |
    |    |->720p_001.ts
    |    ...
    |    |->720p.m3u8
    |
    |->playlist.m3u8
```

## –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è:

- –ú–æ–∂–Ω–æ —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞—Ç—å ffmpeg —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π cuda –¥—Ä–∞–π–≤–µ—Ä–∞ –¥–ª—è –≤–∏–¥–µ–æ–∫–∞—Ä—Ç Nvidia.
- –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –Ω–∞–ª–∏—á–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è ffmpeg.
- –ü–æ–¥—Ä–∞–∑—É–º–µ–≤–∞–µ—Ç—Å—è –æ–¥–∏–Ω–∞–∫–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∏—Å–∫–æ–≤ –¥–ª—è VOD —Å–µ—Ä–≤–µ—Ä–∞.
- –ß–∞—Å—Ç—å –ø—É—Ç–µ–π –∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω—ã, –±—É–¥–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è, –∑–∞ —Å—á–µ—Ç —á–µ–≥–æ –ø–æ—è–≤—è—Ç—Å—è –Ω–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ .env

## –ù–∞—Å—Ç—Ä–æ–π–∫–∏:

–í—Å–µ –∫–ª—é—á–µ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–ø–∏—Å–∞–Ω—ã –≤ —Ñ–∞–π–ª–µ `.env`:

- `SUPPORTED_EXTENSIONS` - –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã
- `INPUT_DIR` - –ö–æ—Ä–Ω–µ–≤–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å —Ñ–∏–ª—å–º–∞–º–∏
- `TARGET_DIR` - –¶–µ–ª–µ–≤–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Ä–µ–∑–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
- `TRANSCODE_DEBUG` - –í–∫–ª—é—á–µ–Ω–∏–µ/–æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –¥–µ–±–∞–≥-—Ä–µ–∂–∏–º–∞
- `MASTER_PLAYLIST` - –ò–º—è –º–∞—Å—Ç–µ—Ä-–ø–ª–µ–π–ª–∏—Å—Ç–∞
- `CONTENT_MAKER_ADDR` - –ê–¥—Ä–µ—Å –º–µ–π–∫–µ—Ä —Å–µ—Ä–≤–µ—Ä–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø–∏—Å–µ–π –≤ Smarty

## –ó–∞–ø—É—Å–∫ –≤–æ—Ä–∫–µ—Ä–æ–≤:

–î–ª—è –∑–∞–ø—É—Å–∫–∞ –≤–æ—Ä–∫–µ—Ä–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É:

```bash
symfony console messenger:consume transcoding
```

–ù–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∑–∞–ø—É—Å–∫–∞—Ç—å –±–æ–ª–µ–µ –æ–¥–Ω–æ–≥–æ –≤–æ—Ä–∫–µ—Ä–∞.

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:

- –°–±–æ—Ä –ª–æ–≥–æ–≤ –æ —É—Å–ø–µ—Ö–µ —Ç—Ä–∞–Ω—Å–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è
- –í—ã–≤–æ–¥ ffmpeg
- –û—à–∏–±–∫–∏ (–≤—ã–≤–æ–¥ ffmpeg –±—É–¥–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω –≤ –±—É–¥—É—â–µ–º)

## –ü—Ä–∏–º–µ—Ä –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–¥–∞—á–∏ –Ω–∞ —Ç—Ä–∞–Ω—Å–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –ø–æ–º–æ—â—å—é cURL:

```bash
curl -X 'POST' \
  'https://example.com/api/create/task' \
  -H 'accept: application/json' \
  -H 'Content-Type: application/json' \
  -d '{
  "kinopoiskId": "401152",
  "title": "Avatar_Aang_serial",
  "isSerial": false,
  "isTrailler": false,
  "seasonCount": "",
  "sameEpisodesCount": false,
  "sameEpisodes": [],
  "episodesCount": [],
  "uploadToSmarty": "no",
  "transcode": true,
  "fileName": "Avatar_1080p_by_krosh",
  "handhdd": false,
  "selectedDisk": 20,
  "user": "k9lis"
  }'
```
